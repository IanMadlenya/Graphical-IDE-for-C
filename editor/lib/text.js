function Text(n,i,j,h,l,m,k){this.str=n;this.font=h;this.size=l;this.lineSpacing=1/4*l;this.align=k||Text.ALIGN_CENTER;this.vector=[new Point(i,j),new Point(i,j-20)];this.style=new Style();if(!m){this.bounds=this.getNormalBounds()}this.oType="Text"}Text.load=function(c){var d=new Text(c.str,c.x,c.y,c.font,c.size,false,c.align);d.vector=Point.loadArray(c.vector);d.style=Style.load(c.style);return d};Text.ALIGN_LEFT="left";Text.ALIGN_CENTER="center";Text.ALIGN_RIGHT="right";Text.ALIGNMENTS=[{Value:Text.ALIGN_LEFT,Text:"Left"},{Value:Text.ALIGN_CENTER,Text:"Center"},{Value:Text.ALIGN_RIGHT,Text:"Right"}];Text.FONTS=[{Value:"arial",Text:"Arial"},{Value:"arial narrow",Text:"Arial Narrow"},{Value:"courier new",Text:"Courier New"},{Value:"tahoma",Text:"Tahoma"}];Text.SPACE_BETWEEN_CHARACTERS=2;Text.DEFAULT_SIZE=10;Text.prototype={constructor:Text,getTextSize:function(){return this.size},setTextSize:function(f){var e=this.getNormalBounds().getBounds();var h=this.size;this.size=f;var g=this.getNormalBounds().getBounds()},getTextStr:function(){return this.str},setTextStr:function(f){var e=this.getNormalBounds().getBounds();this.str=f;var d=this.getNormalBounds().getBounds()},_getContext:function(){return document.getElementById("a").getContext("2d")},transform:function(b){this.vector[0].transform(b);this.vector[1].transform(b)},getAngle:function(){return Util.getAngle(this.vector[0],this.vector[1])},getNormalWidth:function(){var g=this.str.split("\n");var i=[];var h=0;this._getContext().save();this._getContext().font=this.size+"px "+this.font;for(var f in g){var j=this._getContext().measureText(g[f]);i[f]=j.width}this._getContext().restore();for(f=0;f<i.length;f++){if(h<i[f]){h=i[f]}}return h},getNormalHeight:function(){var e=this.str.split("\n");var f=e.length;var d=0;if(f>0){d=f*this.size+(f-1)*this.lineSpacing}return d},paint:function(w){w.save();var i=this.str.split("\n");var x=0;var q=this.size;this.lineSpacing=1/4*this.size;var p=this.lineSpacing;var r=q+p;var s=0;if(this.align==Text.ALIGN_LEFT){s=-this.getNormalWidth()/2}else{if(this.align==Text.ALIGN_RIGHT){s=this.getNormalWidth()/2}}var t=0.5*this.size;var v=Util.getAngle(this.vector[0],this.vector[1]);if(DIAGRAMO.debug){w.beginPath();w.moveTo(this.vector[0].x,this.vector[0].y);w.lineTo(this.vector[1].x,this.vector[1].y);w.closePath();w.stroke();var n=this.getNormalBounds();n.transform(Matrix.translationMatrix(-this.vector[0].x,-this.vector[0].y));n.transform(Matrix.rotationMatrix(v));n.transform(Matrix.translationMatrix(this.vector[0].x,this.vector[0].y));n.style.strokeStyle="rgb(250, 34, 35)";n.paint(w);w.save();w.strokeStyle="rgb(30, 204, 35)";var o=n.getBounds();w.beginPath();w.moveTo(o[0],o[1]);w.lineTo(o[2],o[1]);w.lineTo(o[2],o[3]);w.lineTo(o[0],o[3]);w.closePath();w.stroke();w.restore()}w.translate(this.vector[0].x,this.vector[0].y);w.rotate(v);w.translate(-this.vector[0].x,-this.vector[0].y);w.fillStyle=this.style.fillStyle;w.font=this.size+"px "+this.font;w.textAlign=this.align;w.textBaseline="middle";for(var u=0;u<i.length;u++){w.fillText(i[u],this.vector[0].x+s,(this.vector[0].y-this.getNormalHeight()/2+u*this.size+u*this.lineSpacing)+t);x=x+1}w.restore()},getBounds:function(){var c=Util.getAngle(this.vector[0],this.vector[1]);var d=this.getNormalBounds();d.transform(Matrix.translationMatrix(-this.vector[0].x,-this.vector[0].y));d.transform(Matrix.rotationMatrix(c));d.transform(Matrix.translationMatrix(this.vector[0].x,this.vector[0].y));return d.getBounds()},getNormalBounds:function(){var d=this.str.split("\n");var c=new Polygon();c.addPoint(new Point(this.vector[0].x-this.getNormalWidth()/2,this.vector[0].y-this.getNormalHeight()/2));c.addPoint(new Point(this.vector[0].x+this.getNormalWidth()/2,this.vector[0].y-this.getNormalHeight()/2));c.addPoint(new Point(this.vector[0].x+this.getNormalWidth()/2,this.vector[0].y+this.getNormalHeight()/2));c.addPoint(new Point(this.vector[0].x-this.getNormalWidth()/2,this.vector[0].y+this.getNormalHeight()/2));return c},getPoints:function(){return[]},contains:function(f,g){var h=Util.getAngle(this.vector[0],this.vector[1]);var e=this.getNormalBounds();e.transform(Matrix.translationMatrix(-this.vector[0].x,-this.vector[0].y));e.transform(Matrix.rotationMatrix(h));e.transform(Matrix.translationMatrix(this.vector[0].x,this.vector[0].y));return e.contains(f,g,true)},near:function(f,h,g){var i=Util.getAngle(this.vector[0],this.vector[1]);var j=this.getNormalBounds();j.transform(Matrix.translationMatrix(-this.vector[0].x,-this.vector[0].y));j.transform(Matrix.rotationMatrix(i));j.transform(Matrix.translationMatrix(this.vector[0].x,this.vector[0].y));return j.near(f,h,g)},equals:function(d){if(!d instanceof Text){return false}if(this.str!=d.str||this.font!=d.font||this.size!=d.size||this.lineSpacing!=d.lineSpacing||this.size!=d.size){return false}for(var c=0;c<this.vector.length;c++){if(!this.vector[c].equals(d.vector[c])){return false}}if(!this.style.equals(d.style)){return false}return true},clone:function(){var b=new Text(this.str,this.x,this.y,this.font,this.size,this.outsideCanvas);b.align=this.align;b.vector=Point.cloneArray(this.vector);b.style=this.style.clone();if(!b.outsideCanvas){b.bounds=this.bounds.clone()}return b},toString:function(){return"Text: "+this.str+" x:"+this.vector[0].x+" y:"+this.vector[0].y},escapeString:function(h){var f=new String(h);var g=[];g.push(["<","&lt;"]);for(var e=0;e<g.length;e++){f=f.replace(g[e][0],g[e][1])}return f},toSVG:function(){var l=this.getAngle()*180/Math.PI;var p=this.getNormalHeight();var i=0;var k="middle";if(this.align==Text.ALIGN_LEFT){i=-this.getNormalWidth()/2;k="start"}else{if(this.align==Text.ALIGN_RIGHT){i=this.getNormalWidth()/2;k="end"}}var j="\n"+repeat("\t",INDENTATION)+'<text y="'+(this.vector[0].y-p/2)+'" ';j+=' transform="rotate('+l+" "+this.vector[0].x+" ,"+this.vector[0].y+')" ';j+=' font-family="'+this.font+'" ';j+=' font-size="'+this.size+'" ';if(this.style.fillStyle!=null){j+=' fill=" '+this.style.fillStyle+'" '}j+=' text-anchor="'+k+'" ';j+=">";INDENTATION++;var n=this.str.split("\n");for(var m=0;m<n.length;m++){var o=parseFloat(this.size);if(m>0){o+=parseFloat(this.lineSpacing)}j+="\n"+repeat("\t",INDENTATION)+'<tspan x="'+(this.vector[0].x+i)+'" dy="'+o+'">'+this.escapeString(n[m])+"</tspan>"}INDENTATION--;j+="\n"+repeat("\t",INDENTATION)+"</text>";if(this.debug){j+="\n"+repeat("\t",INDENTATION)+'<circle cx="'+this.vector[0].x+'" cy="'+this.vector[0].y+'" r="3" style="stroke: #FF0000; fill: yellow;"  transform="rotate('+l+" "+this.vector[0].x+" ,"+this.vector[0].y+')" />';j+="\n"+repeat("\t",INDENTATION)+'<circle cx="'+this.vector[0].x+'" cy="'+(this.vector[0].y-p/2)+'" r="3" style="stroke: #FF0000; fill: green;"  transform="rotate('+l+" "+this.vector[0].x+" ,"+this.vector[0].y+')"  />'}return j}};